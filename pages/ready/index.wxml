<game-canvas blur scale animate/>

<view wx:if="{{stage<1 || isHost}}" class='container'>
    <text class='title'>玩家</text>
    <view class='players'>
        <seat judge player="{{judge}}" alive="{{true}}"/>
        <seat
            wx:for="{{seats}}" 
            wx:for-item="index" 
            wx:key="{{index}}"
            bind:click="showMarker"
            open="{{isHost || stage===-1}}"
            player="{{players[index]}}"
            alive="{{players[index].alive}}"
        />
    </view>
    <text class='title'>角色</text>
     <view class='roles'>
        <role
            readOnly="{{!isHost || stage!==0}}"
            wx:for="{{roleMap}}" 
            wx:for-item="role"
            bind:increase="increaseRole"
            bind:decrease="decreaseRole"
            key="{{role.key}}"
            name="{{role.name}}"
            count="{{role.count}}"
            wx:key="{{role.name}}"
        />
    </view>
</view>

<!-- 法官视角 -->
<block wx:if="{{isHost}}">
    <view wx:if="{{stage === -1}}" class='btn btn-warn' bindtap="resetGame">重新开始</view>
    <view wx:if="{{stage === 0}}" class='btn btn-success' bindtap="startGame">开始游戏</view>
    <block wx:if="{{stage === 1}}">
        <view class='btn btn-success vote' bindtap="createVote">发起投票</view>
        <view class="btn-group">
            <view class='btn btn-danger' bindtap="resetGame">重置房间</view>
            <view class='btn btn-danger' bindtap="startGame">重新发牌</view>
            <view class='btn btn-warn' bindtap="openAllRoles">公布身份</view>
        </view>
    </block>
    <!-- 标记器 -->
    <dialog animation="scale" bind:hide="hideMarker" wx:if="{{markerVisiable}}">
        <view slot="content" class='mark-items'>
            <view class="head">
                <seat
                    horizontal
                    open="{{true}}"
                    player="{{markerTarget}}"
                    alive="{{markerTarget.alive}}"
                />
            </view>
            <view catchtap="markPlayer" data-type="sheriff">标记为警长</view>
            <view catchtap="markPlayer" data-type="out">标记出局</view>
            <view catchtap="markPlayer" data-type="alive">标记存活</view>
        </view>
    </dialog>
</block>

<!-- 非法官视角 -->
<block wx:else>
    <card
        wx:if="{{stage>=1}}" 
        shake="{{myCardShake}}" 
        type="{{me.role.type}}"
        alive="{{me.alive}}"
        police="{{sheriff===me.userId}}"
    />
    <!-- 标记器 -->
    <dialog animation="scale" bind:hide="hideMarker" wx:if="{{markerVisiable}}">
        <view slot="content" class='mark-items'>
            <view class="head">
                <seat
                    horizontal
                    open="{{true}}"
                    player="{{markerTarget}}"
                    alive="{{markerTarget.alive}}"
                />
            </view>
            <view catchtap="markPlayer" data-type="wolf">狼人</view>
            <view catchtap="markPlayer" data-type="safe">好人</view>
        </view>
    </dialog>
</block>

<!-- 投票器 wx:if="{{stage===2}}" -->
<voter
    wx:if="{{stage===2}}"
    vid="{{voter.id}}"
    name="{{voter.name}}"
    tickets="{{voter.tickets}}" 
    is-host="{{isHost}}"
    view-mode="{{isHost || isVoted}}"
    bind:vote="onVote"
    bind:hide="onVoterHide"
    bind:close="onVoterClose"
    shake="{{voterShake}}"
    options="{{alives}}" 
/>